{% load static %}
<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Interactive</title>
        <script src="https://unpkg.com/d3@3.5"></script>
        <script src="{% static 'js/fornac.js' %}"></script>
        <link rel="stylesheet" href="{% static 'css/fornac.css' %}">
        <link rel="stylesheet" href="{% static 'css/interactive.css' %}">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    </head>
    <body>
        {% comment %} <div style="height:100%">
            <div id='rna_ss' class="mb-2"></div>
        </div>
        <nav class="navbar fixed-bottom navbar-light bg-light">
            <div class="container-fluid">
              <a class="navbar-brand" href="#">Fixed bottom</a>
            </div>
        </nav> {% endcomment %}
        <div class="main-body">
            <div id="rna_ss" class="mb-2"></div>
        </div>
        <div class="footer">
            Here there are a lot of buttons!
        </div>
        <script>
            function createContainer(width, height) {
                var seq = 'AAAACCGGGCCUUUUACCCCAAAUUGGAA';
                var str = '......(((..[[[[[.)))....]]]]]';
                var container = new fornac.FornaContainer("#rna_ss",
                {'animation': true, 'zoomable': true, 'initialSize':[width, height]});

                 var options = {'structure': str,
                    'sequence': seq
                };
                container.addRNA(options.structure, options);
                return container;
            }
            function init() {
                window.container = createContainer(window.width, window.height);
                setSize();
                // window.container.centerView();
            }

            function setSize() {
                // get size of main-body element
                var mainBody = document.querySelector(".main-body");
                window.width = mainBody.offsetWidth/4;
                window.height = mainBody.offsetHeight/4;

                // save width and height
                window.container.options.svgW = window.width;
                window.container.options.svgH = window.height;
                var options = window.container.options;

                // set the viewBox
                // var svg = document.querySelector("svg");
                // svg.setAttribute('viewBox', "0 0 " + svgW + " " + svgH);
                var svg = window.container.options.svg;
                svg.attr('viewBox', "0 0 " + window.width + " " + window.height)

                // Set the output range of the scales
                var xScale = d3.scale.linear().domain([0, options.svgW]).range([0, options.svgW]);
                xScale.range([0, window.width]).domain([0, window.width]);
                var yScale = d3.scale.linear().domain([0, options.svgH]).range([0,  options.svgH]);
                yScale.range([0, window.height]).domain([0, window.height]);

                // re-attach the scales to the zoom behaviour
                window.container.zoomer.x(xScale).y(yScale);
                window.container.brusher.x(xScale).y(yScale);

                //resize the background
                svg.select('.background').attr('width', window.width).attr('height', window.height);

                // center the view
                window.container.centerView();
            }

            window.onload = init;
            window.addEventListener('resize', setSize);
        </script>
    </body>
</html>